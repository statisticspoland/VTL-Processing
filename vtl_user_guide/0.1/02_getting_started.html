<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: VTL Processing Documentation</title>
    <link rel="canonical" href="https://statisticspoland.github.io/VTL-Processing/vtl_user_guide/0.1/02_getting_started.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="../../_/css/search.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://statisticspoland.github.io/VTL-Processing">VTL Processing Documentation</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="vtl_user_guide" data-version="0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">User guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="01_overview.html">Overview</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="02_getting_started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="03_basic_usage.html">Basic Usage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="06_supported_operators.html">Supported Operators</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">User guide</span>
    <span class="version">0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">User guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">User guide</a></li>
    <li><a href="02_getting_started.html">Getting Started</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/statisticspoland/VTL-Processing/edit/master/docs-source/Guide/modules/ROOT/pages/02_getting_started.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>VtlProcessing is a .NET Core library, which allows to perform translations between VTL and selected target languages.
In this step-by-step guide we will create a simple console application utilizing VTL Processing to generate T-SQL target code from VTL source.
VtlProcessing provides support for .NET Core IoC containers.
However, in this guide we will use different, simplified set of API.
This is the provided facade class.</p>
</div>
<div class="sect2">
<h3 id="_project_setup"><a class="anchor" href="#_project_setup"></a>Project setup</h3>
<div class="paragraph">
<p>VtlProcessing is divided into few modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>VtlProcessing.Core</strong> - transformation od VTL expressions to the form of intermediate representation (IR)</p>
</li>
<li>
<p><strong>VtlProcessing.Targets.TSQL</strong> - generation of Transact SQL target code from supplied IR objects</p>
</li>
<li>
<p><strong>VtlProcessing.Targets.PlantUml</strong> - generation of Transact SQL target code from supplied IR objects, helps to visualize and debug VTL code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these modules has separate Nuget package and need to be referenced individually.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by creating new console application .Net Core 3.1 project.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/new_project1.jpg" alt="new project1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/new_project3.jpg" alt="new project3">
</div>
</div>
<div class="paragraph">
<p>Next, add required VtlProcessing dependencies.
We will need two Nuget packages: <strong>StatisticsPoland.VtlProcessing.Core</strong> and <strong>StatisticsPoland.VtlProcessing.Targets.TSQL</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/new_project5.jpg" alt="new project5">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_and_configure_translator"><a class="anchor" href="#_create_and_configure_translator"></a>Create and configure translator</h3>
<div class="paragraph">
<p>With dependencies added, let&#8217;s create a new object of class <em>Translator</em>.
It is found in the "<em>StatisticsPoland.VtlProcessing.Core</em>" namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">using StatisticsPoland.VtlProcessing.Core;

namespace VtlTestApp
{
    class Program
    {
        static void Main(string[] args)
        {
            Translator translator = new Translator((configure) =&gt;
            {
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we need to configure the use of the T-SQL translation target language.
If we want comments to be generated in target code, include appropriate setting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">...
using StatisticsPoland.VtlProcessing.Target.TSQL.Infrastructure;

namespace VtlTestApp
{ ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">Translator translator = new Translator((configure) =&gt;
{
    configure.AddTsqlTarget((config) =&gt;
    {
        config.AddComments();
    });
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setup_data_model"><a class="anchor" href="#_setup_data_model"></a>Setup data model</h3>
<div class="paragraph">
<p>The translation process need information about data structures it will work with.
This need to be configured.
In our simple case, we will use a json file containing all necessary metadata.
Let&#8217;s create an empty <em>DataModel.json</em> file.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/new_project7.jpg" alt="new project7">
</div>
</div>
<div class="paragraph">
<p>Paste the following content into the <em>DataModel.json</em> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "DataModel": {
    "Namespace": "JsonTest",
    "DataStructuresCollection": [
      {
        "DatasetName": "X",
        "Identifiers": [
          {
            "BaseComponentName": "Id1",
            "ComponentName": "Id1",
            "ValueDomain": {
              "Signature": "integer_default"
            }
          }
        ],
        "Measures": [
          {
            "BaseComponentName": "Me1",
            "ComponentName": "Me1",
            "ValueDomain": {
              "Signature": "integer_default"
            }
          },
          {
            "BaseComponentName": "Me2",
            "ComponentName": "Me2",
            "ValueDomain": {
              "Signature": "integer_default"
            }
          }
        ],
        "ViralAttributes":
        [
            {
                "BaseComponentName": "At1",
                "ComponentName": "At1",
                "ValueDomain": {
                  "Signature": "string_default"
                }
            }
        ]
      }
      {
        "DatasetName": "Y",
        "Identifiers": [
          {
            "BaseComponentName": "Id1",
            "ComponentName": "Id1",
            "ValueDomain": {
              "Signature": "integer_default"
            }
          },
          {
            "BaseComponentName": "Id2",
            "ComponentName": "Id2",
            "ValueDomain": {
              "Signature": "integer_default"
            }
          }
        ],
        "Measures": [
          {
            "BaseComponentName": "Me1",
            "ComponentName": "Me1",
            "ValueDomain": {
              "Signature": "integer_default"
            }
          },
          {
            "BaseComponentName": "Me2",
            "ComponentName": "Me2",
            "ValueDomain": {
              "Signature": "number_default"
            }
          }
        ]
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It holds all necessary structure metadata about two datasets <em>X</em> and <em>Y</em> in data model namespace <em>JsonTest</em>.
It can be visualized as following:</p>
</div>
<div class="imageblock plantuml">
<div class="content">
<img src="_images/3c141132626b76ed16f5424329a4f2d7da9d552a.png" alt="diagram">
</div>
<div class="title">Figure 1. Data structures in the namespace "JsonTest"</div>
</div>
<div class="paragraph">
<p>Set <code>Copy to Output Directory</code> property to <code>Copy if newer</code> value.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/new_project8.jpg" alt="new project8">
</div>
</div>
<div class="paragraph">
<p>Next, we need to link our Json file as a data model source to the translator object.
Also set the default namespace used by the translator to "JsonTest".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">...
using StatisticsPoland.VtlProcessing.Core.DataModelProviders;
using System.IO;

namespace VtlTestApp
{ ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">translator.DataModels.AddJsonModel($"{Directory.GetCurrentDirectory()}\\DataModel.json");
translator.DataModels.DefaultNamespace = "JsonTest";</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setup_environment_mapping"><a class="anchor" href="#_setup_environment_mapping"></a>Setup environment mapping</h3>
<div class="paragraph">
<p>Next phase is to configure environment mapper of the translator.
It can be done by providing a <code>Dictionary&lt;string, string&gt;</code> object.
In the following example we will map <em>JsonTests</em> namespace to the <em>SqlDatabase</em> schema of the target database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">...
using System.Collections.Generic;

namespace VtlTestApp
{ ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">translator.EnvironmentMapper.Mapping = new Dictionary&lt;string, string&gt;()
{
    { "JsonTest", "[SqlDatabase]." }
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_translation"><a class="anchor" href="#_run_translation"></a>Run translation</h3>
<div class="paragraph">
<p>Translator object is now ready to use.
Let&#8217;s do the translation of simple VTL expression:  <code>Z := X + Y</code>
Just call the <code>Translate</code> method to get the result string containing executable T-SQL code.
Finally, we put the result into the console output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">...
using System;

namespace VtlTestApp
{ ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">string vtlSource = "Z := X + Y";
string tsqlResult = translator.Translate(vtlSource, "TSQL");

Console.WriteLine(tsqlResult);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The printed result should look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">-- Script generated: 23.07.2021 12:13:04
BEGIN TRANSACTION

IF OBJECT_ID (N'tempdb..#Z', N'U') IS NOT NULL
DROP TABLE #Z


-- Raw: Z := X + Y
SELECT * INTO #Z FROM (
SELECT
ds1.Id1,
ds2.Id2,
ds1.Me1 + ds2.Me1 AS Me1,
ds1.Me2 + ds2.Me2 AS Me2,
(SELECT MIN(VALUE) FROM
(SELECT ds1.At1 AS VALUE UNION
SELECT ds2.At1 AS VALUE) AS t) AS At1
FROM [SqlDatabase].X AS ds1
INNER JOIN [SqlDatabase].Y AS ds2
ON
ds1.Id1 = ds2.Id1
) AS t


COMMIT TRANSACTION
GO</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_complete_sample"><a class="anchor" href="#_complete_sample"></a>Complete sample</h3>
<div class="paragraph">
<p>Here we have complete source code of sample application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">using StatisticsPoland.VtlProcessing.Core.DataModelProviders;
using StatisticsPoland.VtlProcessing.Core.UserInterface;
using StatisticsPoland.VtlProcessing.Target.TSQL.Infrastructure;
using System;
using System.Collections.Generic;
using System.IO;

namespace VtlTestApp
{
    class Program
    {
        static void Main(string[] args)
        {
            Translator translator = new Translator((configure) =&gt;
            {
                configure.AddTsqlTarget((config) =&gt;
                {
                    config.AddComments();
                });
            });

            translator.DataModels.AddJsonModel(
                $"{Directory.GetCurrentDirectory()}\\DataModel.json");
            translator.DataModels.DefaultNamespace = "JsonTest";

            translator.EnvironmentMapper.Mapping = new Dictionary&lt;string, string&gt;()
            {
                { "JsonTest", "[SqlDatabase]." }
            };

            string vtlSource = "Z := X + Y";
            string tsqlResult = translator.Translate(vtlSource, "TSQL");

            Console.WriteLine(tsqlResult);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>The UI for this site is based on the default Antora UI and is licensed under the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/vendor/search.js" id="search-script" data-base-path="../.." data-page-path="/vtl_user_guide/0.1/02_getting_started.html"></script>
<script async src="../../_/../search-index.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
